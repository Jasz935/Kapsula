<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kapsula ‚Äî Creaci√≥n de Presupuesto (Prototipo)</title>
  </head>

    </div>
  </div>
  <body>
    <div class="page">
      <main class="container" role="main" aria-labelledby="title">
        <header class="top">
          <div class="brand" aria-hidden="true">Kapsula</div>
          <button class="help" aria-label="Ayuda">Ayuda</button>
        </header>

        <h1 id="title">Creaci√≥n de Presupuesto</h1>

        <form id="budgetForm" class="card" novalidate>
          <!-- Salario -->
          <div>
            <label for="salary">Ingrese su salario total</label>
            <div class="input-row" style="gap: 10px">
              <div class="currency-prefix" aria-hidden="true">$</div>
              <input
                id="salary"
                name="salary"
                type="text"
                placeholder="Ej: 2500000"
                min="0"
                step="1"
                aria-describedby="salaryHelp"
                required
              />
            </div>
            <div id="salaryHelp" class="hint">
              Ingrese el ingreso mensual neto (sin puntos ni comas si usa
              n√∫mero).
            </div>
          </div>

          <!-- Porcentajes -->
          <div>
            <label>Ingrese la cantidad a usar por categor√≠a</label>

            <div style="display: grid; gap: 10px">
              <div class="row-2col">
                <div>Gastos mensuales</div>
                <div class="percent-box">
                  <input
                    id="gastos"
                    class="number-input"
                    type="text"
                    min="0"
                    max="salary"
                    step="1"
                    placeholder="$"
                    aria-label="Gastos mensuales ($)"
                    required
                  />
                  <div
                    class="hint"
                    style="margin-top: 6px; color: var(--muted)"
                  >
                    $COP
                  </div>
                </div>
              </div>

              <div class="row-2col">
                <div>Ahorro / Inversi√≥n</div>
                <div class="percent-box">
                  <input
                    id="ahorro"
                    class="number-input"
                    type="text"
                    min="0"
                    max="salary"
                    step="1"
                    placeholder="$"
                    aria-label="Ahorro o inversi√≥n ($)"
                    required
                  />
                  <div
                    class="hint"
                    style="margin-top: 6px; color: var(--muted)"
                  >
                    $COP
                  </div>
                </div>
              </div>

              <div class="row-2col">
                <div>Libre</div>
                <div class="percent-box">
                  <input
                    id="libre"
                    class="number-input"
                    type="text"
                    min="0"
                    max="100"
                    step="1"
                    placeholder="$"
                    aria-label="Dinero libre ($)"
                    required
                  />
                  <div
                    class="hint"
                    style="margin-top: 6px; color: var(--muted)"
                  >
                    $COP
                  </div>
                </div>
              </div>
            </div>

            <div
              style="
                display: flex;
                gap: 10px;
                margin-top: 12px;
                align-items: center;
              "
            >
              <div id="sumNote" class="note" role="alert">
                La suma de montos debe ser igual al salario base ingresado.
              </div>
              <div id="sumOk" class="sum-ok">
                Total = <span id="totalSum">0</span>$
              </div>
            </div>
          </div>

          <!-- Acciones -->
          <div class="actions" style="margin-top: 6px">
            <button id="createBtn" class="btn" type="submit" disabled>
              Crear Presupuesto
            </button>

     
          </div>
        </form>
        <div id="modal" class="modal">
  <div class="modal-content">
    <span id="closeModal" class="close-btn">√ó</span>
    <h2>Presupuesto creado correctamente</h2>
    <p><strong>Salario: </strong><span id="m-salary"></span></p>
    <p><strong>Gastos mensuales: </strong><span id="m-gastos"></span></p>
    <p><strong>Ahorro / Inversi√≥n: </strong><span id="m-ahorro"></span></p>
    <p><strong>Libre: </strong><span id="m-libre"></span></p>

    <div class="modal-actions">
      <button id="closeBtn" class="btn-close">Cerrar</button>
    </div>
  </div>
</div>
      </main>

    <script>
      // Elementos
      const gastos = document.getElementById("gastos");
      const ahorro = document.getElementById("ahorro");
      const libre = document.getElementById("libre");
      const totalSumEl = document.getElementById("totalSum");
      const sumNote = document.getElementById("sumNote");
      const sumOk = document.getElementById("sumOk");
      const createBtn = document.getElementById("createBtn");
      const form = document.getElementById("budgetForm");
      const salary = document.getElementById("salary");

      // Convierte "1.234.567" -> 1234567 (Number)
      function parseInputValue(el) {
        if (!el || !el.value) return 0;
        return Number(el.value.replace(/\D/g, "")) || 0;
      }

      // Formatea y escribe en el input (mantiene solo n√∫meros internamente)
      function formatNumberInput(input) {
        // Guardar posici√≥n del cursor (mejora UX cuando se escribe)
        const selectionStart = input.selectionStart;
        const beforeLength = input.value.length;

        let raw = input.value.replace(/\D/g, "");
        if (raw === "") {
          input.value = "";
          return 0;
        }
        const num = Number(raw);
        input.value = num.toLocaleString("es-CO");

        // tratar de restaurar caret (posible aproximaci√≥n; no es perfecta en todos los navegadores)
        try {
          const afterLength = input.value.length;
          const diff = afterLength - beforeLength;
          const newPos = Math.max(0, selectionStart + diff);
          input.setSelectionRange(newPos, newPos);
        } catch (e) {
          // si falla no pasa nada
        }

        return num;
      }

      // Actualiza suma y estado del bot√≥n
      function updateSum() {
        const a = parseInputValue(gastos);
        const b = parseInputValue(ahorro);
        const c = parseInputValue(libre);
        const total = a + b + c;
        totalSumEl.textContent = total.toLocaleString("es-CO");

        const s = parseInputValue(salary);

        if (s > 0 && total === s) {
          sumNote.style.display = "none";
          sumOk.style.display = "inline-block";
          createBtn.disabled = false;
        } else {
          sumOk.style.display = "none";
          sumNote.style.display = "inline-block";
          createBtn.disabled = true;
        }
      }

      // Comportamiento salary
      salary.addEventListener("input", () => {
        formatNumberInput(salary);
        updateSum();
      });

      salary.addEventListener("blur", () => {
        // al perder foco, asegurar formato bonito
        if (salary.value === "") return;
        const v = parseInputValue(salary);
        salary.value = v === 0 ? "" : v.toLocaleString("es-CO");
        updateSum();
      });

      // Inputs gastos/ahorro/libre
      [gastos, ahorro, libre].forEach((el) => {
        // mientras escribe -> formatea
        el.addEventListener("input", () => {
          formatNumberInput(el);
          updateSum();
        });

        // al perder foco -> validar l√≠mites
        el.addEventListener("blur", () => {
          if (el.value === "") return;

          let v = parseInputValue(el);
          if (v < 0) v = 0;

          const s = parseInputValue(salary);
          if (s > 0 && v > s) v = s;

          el.value = v === 0 ? "" : v.toLocaleString("es-CO");
          updateSum();
        });
      });

      // Submit
      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const a = parseInputValue(gastos);
        const b = parseInputValue(ahorro);
        const c = parseInputValue(libre);
        const total = a + b + c;
        const s = parseInputValue(salary);
        const modal = document.getElementById("modal");
        const closeModal = document.getElementById("closeModal");

        if (total !== s) return;

  // üî• Rellenar valores del modal
  modal.style.display = "flex"; // <-- abre el modal
document.getElementById("m-salary").textContent = s.toLocaleString("es-CO");
document.getElementById("m-gastos").textContent = a.toLocaleString("es-CO");
document.getElementById("m-ahorro").textContent = b.toLocaleString("es-CO");
document.getElementById("m-libre").textContent = c.toLocaleString("es-CO");
});

// Cerrar modal
    document.getElementById("closeModal").onclick = () => modal.style.display = "none";
document.getElementById("closeBtn").onclick = () => {modal.style.display = "none"
 window.location.href = `${window.location.origin}/Kapsula/gastos.html`;
};

// Cerrar si se hace clic fuera del cuadro
window.onclick = (e) => {
  if (e.target === modal) modal.style.display = "none";
};
      ;
      // estado inicial
      updateSum();
    </script>
  </body>
</html>
